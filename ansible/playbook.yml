---
- hosts: bastion
  become: yes
  vars:
    rds_endpoint: "{{ lookup('env','RDS_ENDPOINT') | default(omit) }}"
    db_user: "{{ lookup('env','DB_USER') | default('admin') }}"
  tasks:
    - name: Ensure mysql client is installed (Amazon Linux 2)
      yum:
        name: mysql
        state: present

    - name: Place a helper script to connect to RDS
      copy:
        dest: /home/ec2-user/connect-rds.sh
        owner: ec2-user
        group: ec2-user
        mode: '0755'
        content: |
          #!/bin/bash
          if [ -z "$1" ]; then
            echo "Usage: ./connect-rds.sh <rds-endpoint>"
            exit 1
          fi
          mysql -h "$1" -u "{{ db_user }}" -p
